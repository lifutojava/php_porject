<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"> 
<html>
<head>
<title>管理员页面</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
<link rel="stylesheet" type="text/css" href="../themes/default/easyui.css"/>
<link rel="stylesheet" type="text/css" href="../themes/icon.css"/>
<script type="text/javascript" src="../jquery.min.js"></script>
<script type="text/javascript" src="../jquery.easyui.min.js"></script>
<style type="text/css">
.datagrid-header, .datagrid-td-rownumber {
	height: 27px;
	background-color: #efefef;
	background: -webkit-linear-gradient(top, #F9F9F9 0, #efefef 100%);
	background: -moz-linear-gradient(top, #F9F9F9 0, #efefef 100%);
	background: -o-linear-gradient(top, #F9F9F9 0, #efefef 100%);
	background: linear-gradient(to bottom, #F9F9F9 0, #efefef 100%);
	background-repeat: repeat-x;
	filter: progid:DXImageTransform.Microsoft.gradient(startColorstr=#F9F9F9,
		endColorstr=#efefef, GradientType=0);
}

.layout-split-west {
	
	border-right: 5px solid #E6EEF8;
	border-left: 5px solid #E0ECFF;
}
</style>
</head>
<body class="easyui-layout">
	<div data-options="region:'north'"
		style="height: 40px; background-color: #E6EEF8;">
		<table style="height: 100%; width: 100%;">
			<tr>
				<td style="font-size: 18px; width: 300px;"><span
					style="color: red; font-size: 20px;" id=""></span></td>
				<td style="font-size: 18px; width: 300px;"><span
					style="color: red; font-size: 20px;" id=""></span></td>
				<td style="font-size: 18px; width: 300px;">当前登录用户ID : <span
					style="color: red; font-size: 20px;" id="loginId"></span></td>
				<td style="font-size: 18px; width: 300px;">当前登录用户 : <span
					style="color: red; font-size: 20px;" id="loginName"></span></td>
				<td style="font-size: 18px; width: 100px;"><a href="#" ><span
					style="color: red; font-size: 20px; text-decoration:underline; " 
					onclick="loginOut()">安全退出</span></a></td>
			</tr>
		</table>
	</div>

	<div data-options="region:'west',split:true,title:'主菜单'"
		style="width: 200px; padding: 5px 5; text-align: center;">
			<div class="easyui-linkbutton"
				style="height: 35px; width: 185px; color: blue;" onclick="addTab('阿里接口对接','/MVCPHP/jquery-easyui/mydemo/aliImpl.html')">阿里接口对接</div>
			<div class="easyui-linkbutton"
				style="height: 35px; width: 185px; color: blue;" onclick="addTab('runoob','http://www.runoob.com/')">runoob</div>
			<div class="easyui-linkbutton"
				style="height: 35px; width: 185px; color: blue;" onclick="addTab('jquery官网','http://jquery.com/')">jquery官网</div>
			<div class="easyui-linkbutton"
				style="height: 35px; width: 185px; color: blue;" onclick="addTab('easyui官网','http://jeasyui.com/')">easyui官网</div>
			<div class="easyui-linkbutton"
				style="height: 35px; width: 185px; color: blue;" onclick="addTab('jquery-easyui示例','/MVCPHP/getAllPages.html')">jquery-easyui页面效果浏览</div>
			<div class="easyui-linkbutton"
				style="height: 35px; width: 185px; color: blue;" onclick="addTab('operamasks-ui示例','/MVCPHP/operamasks-ui/index.html')">operamasks-uiAPI</div>
			<div class="easyui-linkbutton"
				style="height: 35px; width: 185px; color: blue;" onclick="addTab('用户权限管理','')">用户权限管理</div>
			<div class="easyui-linkbutton"
				style="height: 35px; width: 185px; color: blue;" onclick="addTab('用户角色管理','')">用户角色管理</div>
			<div class="easyui-linkbutton"
				style="height: 35px; width: 185px; color: blue;" onclick="addTab('角色管理','')">角色管理</div>
			<div class="easyui-linkbutton"
				style="height: 35px; width: 185px; color: blue;" onclick="addTab('操作日志查询','')">操作日志查询</div>
			<div class="easyui-linkbutton"
				style="height: 35px; width: 185px; color: blue;" onclick="addTab('百度','http://www.baidu.com/')">百度</div>
			<div class="easyui-linkbutton"
				style="height: 35px; width: 185px; color: blue;" onclick="addTab('慕课网','http://www.imooc.com')">慕课网</div>
	</div>

	<!-- background:#eee; -->
	<!-- title:'主显示区域' -->
	<div data-options="region:'center'" style="padding: 0px;">
		<div id="tt" class="easyui-tabs" style="width:100%;height:100%;">
		    <div title="用户信息编辑页面" style="padding:1px;display:none;">
				<table id="dg" class="easyui-datagrid" title=""
					style="width: 100%; height: auto"
					data-options="
						fitColumns: true,
			            striped: true,
			            singleSelect: false,
			            pagination: true,
			            rownumbers: true,  
			            pageSize: 15,
			            pageList: [10, 15, 20,25,30],
						iconCls: 'icon-edit',
						url: '/MVCPHP/libs/Controller/controllers.php?mark=user_getAll',
						method:'post',
						onClickCell: onClickCell
					">
					<thead>
						<tr>
							<th data-options="field:'id',width:60">id</th>
							<th
								data-options="field:'toId',align:'center',width:80,editor:'text'">所属组织</th>
							<th
								data-options="field:'name',align:'center',width:80,editor:'text'">登录帐号</th>
							<th
								data-options="field:'password',align:'center',width:80,editor:'text'">密码</th>
							<th
								data-options="field:'vserName',align:'center',width:80,editor:'text'">用户姓名</th>
							<th
								data-options="field:'mobile',align:'center',width:80,editor:'text'">手机号</th>
							<th
								data-options="field:'email',align:'center',width:80,editor:'text'">电子邮箱</th>
							<th data-options="field:'genTime',align:'center',width:80 ">创建时间</th>
							<th
								data-options="field:'XXX1',align:'center',width:50 ,formatter:updat">修改数据</th>
							<th
								data-options="field:'XXX2',align:'center',width:50 ,formatter:delet">删除数据</th>
		<!-- 					<th data-options="field:'listprice',width:80,align:'right',editor:{type:'numberbox',options:{precision:1}}">List Price</th> -->
		<!-- 					<th data-options="field:'unitcost',width:80,align:'right',editor:'numberbox'">Unit Cost</th> -->
		<!-- 					<th data-options="field:'attr1',width:250,editor:'text'">Attribute</th> -->
		<!-- 					<th data-options="field:'status',width:60,align:'center',editor:{type:'checkbox',options:{on:'P',off:''}}">Status</th> -->
						</tr>
					</thead>
				</table>
		    </div>
<!-- 		    <div title="Tab2" data-options="closable:true" style="overflow:auto;padding:20px;display:none;">
		    </div>
		    <div title="Tab3" data-options="iconCls:'icon-reload',closable:true" style="padding:20px;display:none;">
			</div> -->
		</div>
	</div>
	<div data-options="region:'south',split:true,title:'留言板'"
		style="height: 235px;"></div>
</body>
<script type="text/javascript">
	//添加新tab页面
	function addTab(title, url){
		if ($('#tt').tabs('exists', title)){
			$('#tt').tabs('select', title);
		} else {
			var content = '<iframe scrolling="auto" frameborder="0"  src="'+url+'" style="width:100%;height:100%;"></iframe>';
			$('#tt').tabs('add',{
				title:title,
				content:content,
				closable:true
			});
		}
	}
	
	var loginName = getUrlParam("vserName");
	var loginId = getUrlParam("id");
	$("#loginName").html(loginName);
	$("#loginId").html(loginId);
	//获取url中的参数
	function getUrlParam(name) {
		var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象
		//var r = window.location.search.substr(1).match(reg);  //匹配目标参数
		var r = decodeURI(decodeURI(window.location.search.substr(1))).match(
				reg); //获取url中"?"符后的字串，使用了两次decodeRUI解码
		if (r != null)
			return unescape(r[2]);
		return null; //返回参数值
	}
	
	//获取项目路径
	function getContextPath() {
		var pathName = document.location.pathname;
		var index = pathName.substr(1).indexOf("/");
		var result = pathName.substr(0, index + 1);
		return result;
	}

	function updat(val, row, index) {
		return '<a href="#" onclick="editUpdateUser(' + index + ')">保存</a>';
	}

	function delet(val, row, index) {
		return '<a href="#" onclick="editDeletUser(' + index + ')">删除</a>';
	}


	function editUpdateUser(index) {
		$.messager.confirm("提示信息", "确认修改数据?", function(r) {
			if (r) {
				$('#dg').datagrid('selectRow', index);// 关键在这里  
				var row = $('#dg').datagrid('getSelected');
				if (row) {
					$.ajax({
						type : 'POST',
						dataType : 'json',
						async : false, //同步
						url : '/MVCPHP/libs/Controller/controllers.php',
						data : {
							"mark" : "user_update",
							"id" : row.id,
							"toId" : row.toId,
							"name" : row.name,
							"password" : row.password,
							"vserName" : row.vserName,
							"mobile" : row.mobile,
							"email" : row.email
						},
						success : function(data) {
							//登录失败处理
							if (data == null || data != 'success') {
								if (data == null || data != 'success') {
									$.messager.alert("提示消息", "操作失败！！" + data + "!");
								} else if (data == 'success') { //成功处理 
									$.messager.alert("提示消息", "操作成功！！" + data + "!");
									$("#dg").datagrid("reload");
								} else {
									$.messager.alert("提示消息", "操作异常！！" + data + "!");
								}
							}
						}
					})
				}
			}
		});
	}

	function editDeletUser(index) {
		$.messager.confirm("提示信息", "确认删除数据?", function(r) {
			if (r) {
				$('#dg').datagrid('selectRow', index);// 关键在这里  
				var row = $('#dg').datagrid('getSelected');
				if (row) {
					$.ajax({
						type : 'POST',
						dataType : 'json',
						async : false, //同步
						url : '/MVCPHP/libs/Controller/controllers.php',
						data : {
							"mark" : "user_delete",
							"id" : row.id
						},
						success : function(data) {
							$.messager.alert("提示消息", "删除成功！！" + data + "!");
							$("#dg").datagrid("reload");
						}
					})
				}
			}
		});
	}

	function loginOut() {
		$.ajax({
			type : 'POST',
// 			dataType : 'json',
			async : false, //同步
			url : '/MVCPHP/libs/Controller/controllers.php',
			data : {
				"mark" : "user_out"
			},
			success : function(data) {
				window.location.href='/MVCPHP/jquery-easyui/mydemo/index.html';//转主页面
				//top.location.href = "/MVCPHP/jquery-easyui/mydemo/index.html"; //转主页面
			}
		})
	}

	$.extend($.fn.datagrid.methods, {
		editCell : function(jq, param) {
			return jq.each(function() {
				var opts = $(this).datagrid('options');
				var fields = $(this).datagrid('getColumnFields', true).concat(
						$(this).datagrid('getColumnFields'));
				for (var i = 0; i < fields.length; i++) {
					var col = $(this).datagrid('getColumnOption', fields[i]);
					col.editor1 = col.editor;
					if (fields[i] != param.field) {
						col.editor = null;
					}
				}
				$(this).datagrid('beginEdit', param.index);
				for (var i = 0; i < fields.length; i++) {
					var col = $(this).datagrid('getColumnOption', fields[i]);
					col.editor = col.editor1;
				}
			});
		}
	});

	var editIndex = undefined;
	function endEditing() {
		if (editIndex == undefined) {
			return true
		}
		if ($('#dg').datagrid('validateRow', editIndex)) {
			$('#dg').datagrid('endEdit', editIndex);
			editIndex = undefined;
			return true;
		} else {
			return false;
		}
	}
	function onClickCell(index, field) {
		if (endEditing()) {
			$('#dg').datagrid('selectRow', index).datagrid('editCell', {
				index : index,
				field : field
			});
			editIndex = index;
		}
	}
</script>
</html>